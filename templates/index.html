<!doctype html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡πÇ‡∏°‡πÄ‡∏î‡∏•‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      .sentiment-tab {
        font-weight: bold;
        padding: 10px 20px;
        cursor: pointer;
        border-bottom: 3px solid transparent;
      }

      .sentiment-tab.active {
        border-bottom-color: #0d6efd;
        color: #0d6efd;
      }

      .btn-analyze {
        background-color: #0d6efd;
        color: white;
        padding: 10px 20px;
        border-radius: 20px;
        border: none;
      }

      .result-box {
        border: 1px solid #dee2e6;
        border-radius: 10px;
        padding: 20px;
        margin-top: 20px;
      }

      .label-negative {
        background-color: #f8d7da;
        color: #721c24;
        padding: 5px 10px;
        border-radius: 5px;
      }

      .label-positive {
        background-color: #d4edda;
        color: #155724;
        padding: 5px 10px;
        border-radius: 5px;
      }

      .label-neutral {
        background-color: #fff3cd;
        color: #856404;
        padding: 5px 10px;
        border-radius: 5px;
      }

      .word-tag {
        display: inline-block;
        margin: 5px;
        padding: 5px 10px;
        border-radius: 15px;
        font-size: 0.9em;
      }

      .positive-word {
        background-color: #d4edda;
        color: #155724;
      }

      .neutral-word {
        background-color: #fff3cd;
        color: #856404;
      }

      .negative-word {
        background-color: #f8d7da;
        color: #721c24;
      }

      .progress-bar-container {
        height: 10px;
        background-color: #e9ecef;
        border-radius: 5px;
        margin: 10px 0;
      }

      .progress-bar-fill {
        height: 100%;
        border-radius: 5px;
      }

      .toggle-switch {
        position: relative;
        display: inline-block;
        width: 60px;
        height: 34px;
      }

      .toggle-switch input {
        opacity: 0;
        width: 0;
        height: 0;
      }

      .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ccc;
        transition: 0.4s;
        border-radius: 34px;
      }

      .slider:before {
        position: absolute;
        content: "";
        height: 26px;
        width: 26px;
        left: 4px;
        bottom: 4px;
        background-color: white;
        transition: 0.4s;
        border-radius: 50%;
      }

      input:checked + .slider {
        background-color: #2196f3;
      }

      input:checked + .slider:before {
        transform: translateX(26px);
      }

      .feedback-buttons {
        margin-top: 10px;
      }

      .feedback-btn {
        font-size: 1.2em;
        margin-right: 10px;
        cursor: pointer;
        opacity: 0.7;
        transition: opacity 0.2s;
      }

      .feedback-btn:hover {
        opacity: 1;
      }

      .feedback-btn.selected {
        opacity: 1;
        filter: brightness(1.2);
      }

      .true-label-section {
        display: none;
        margin-top: 12px;
        padding-top: 12px;
        border-top: 1px dashed #ddd;
      }

      .submit-feedback-btn {
        margin-top: 8px;
      }

      .bert-badge {
        background-color: #6f42c1;
        color: white;
        font-size: 0.8em;
        padding: 2px 6px;
        border-radius: 4px;
        margin-left: 6px;
      }
    </style>
  </head>

  <body class="bg-light">
    <div class="container mt-4">
      <div class="card shadow-sm p-4">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <div class="d-flex gap-3">
            <div class="sentiment-tab active" id="tab-sentiment">Sentiment</div>
          </div>
          <div class="d-flex align-items-center">
            <!-- Toggle A/B -->
            <div class="toggle-switch me-2">
              <input type="checkbox" id="ab-toggle" checked />
              <span class="slider"></span>
            </div>
            <label for="ab-toggle" class="me-3">‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö A/B</label>

            <!-- Dropdown: ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Model B -->
            <select
              id="model-b-select"
              class="form-select form-select-sm"
              style="width: auto; display: block"
            >
              <option value="linear">Model B: Linear SVM</option>
              <option value="rf">Model B: Random Forest</option>
              <option value="nb">Model B: Naive Bayes</option>
              <option value="lgbm">Model B: LightGBM</option>
              <option value="et">Model B: Extra Trees</option>
            </select>
          </div>
        </div>

        <div class="mb-3">
          <label class="form-label">‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°:</label>
          <textarea
            id="input-text"
            class="form-control"
            rows="4"
            placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå..."
          ></textarea>
        </div>

        <!-- ‡∏õ‡∏∏‡πà‡∏°: ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå + ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° + ‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î -->
        <div class="d-flex gap-2 flex-wrap">
          <button id="analyze-btn" class="btn-analyze">‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå</button>
          <button id="sample-btn" class="btn btn-outline-primary">
            ‡πÇ‡∏´‡∏•‡∏î‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
          </button>
          <a href="/errors" class="btn btn-outline-secondary"
            >‡∏î‡∏π‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î</a
          >
        </div>

        <div id="results-container" class="mt-4" style="display: none">
          <h5 class="text-center mb-3">‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡πÇ‡∏°‡πÄ‡∏î‡∏• A ‡πÅ‡∏•‡∏∞ B</h5>
          <div class="row">
            <div class="col-md-6">
              <div class="result-box">
                <h6>‡πÇ‡∏°‡πÄ‡∏î‡∏• A: Logistic Regression</h6>
                <div id="model-a-label" class="label-neutral mb-2">NEUTRAL</div>
                <div class="d-flex justify-content-between mb-2">
                  <span
                    >Confidence: <span id="model-a-confidence">0.00</span></span
                  >
                  <span>Latency: <span id="model-a-latency">0</span> ms</span>
                </div>
                <div class="progress-bar-container">
                  <div
                    id="model-a-progress"
                    class="progress-bar-fill"
                    style="width: 0%; background-color: #ffc107"
                  ></div>
                </div>
                <p class="mt-3">
                  ‡πÇ‡∏°‡πÄ‡∏î‡∏•:
                  <span id="model-a-name">-</span>
                </p>
                <p>‡∏Ñ‡∏≥‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç:</p>
                <div id="model-a-words" class="d-flex flex-wrap"></div>
                <div class="feedback-buttons">
                  <span
                    class="feedback-btn"
                    data-model="a"
                    data-feedback="correct"
                    >üëç</span
                  >
                  <span
                    class="feedback-btn"
                    data-model="a"
                    data-feedback="incorrect"
                    >üëé</span
                  >
                  <small class="text-muted">(‡∏Å‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ feedback)</small>
                </div>
                <!-- True label section for Model A -->
                <div class="true-label-section" data-model="a">
                  <select class="form-select true-label-select">
                    <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</option>
                    <option value="POSITIVE">üòä ‡∏ö‡∏ß‡∏Å</option>
                    <option value="NEGATIVE">üò† ‡∏•‡∏ö</option>
                    <option value="NEUTRAL">üòê ‡∏Å‡∏•‡∏≤‡∏á</option>
                  </select>
                  <button
                    class="btn btn-sm btn-primary submit-feedback-btn"
                    data-model="a"
                  >
                    ‡∏™‡πà‡∏á Feedback
                  </button>
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="result-box">
                <h6>
                  ‡πÇ‡∏°‡πÄ‡∏î‡∏• B: <span id="model-b-type-display">Linear SVM</span>
                </h6>
                <div id="model-b-label" class="label-neutral mb-2">NEUTRAL</div>
                <div class="d-flex justify-content-between mb-2">
                  <span
                    >Confidence: <span id="model-b-confidence">0.00</span></span
                  >
                  <span>Latency: <span id="model-b-latency">0</span> ms</span>
                </div>
                <div class="progress-bar-container">
                  <div
                    id="model-b-progress"
                    class="progress-bar-fill"
                    style="width: 0%; background-color: #ffc107"
                  ></div>
                </div>
                <p class="mt-3">
                  ‡πÇ‡∏°‡πÄ‡∏î‡∏•:
                  <span id="model-b-name">-</span>
                </p>
                <p>‡∏Ñ‡∏≥‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç:</p>
                <div id="model-b-words" class="d-flex flex-wrap"></div>
                <div class="feedback-buttons">
                  <span
                    class="feedback-btn"
                    data-model="b"
                    data-feedback="correct"
                    >üëç</span
                  >
                  <span
                    class="feedback-btn"
                    data-model="b"
                    data-feedback="incorrect"
                    >üëé</span
                  >
                  <small class="text-muted">(‡∏Å‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ feedback)</small>
                </div>
                <!-- True label section for Model B -->
                <div class="true-label-section" data-model="b">
                  <select class="form-select true-label-select">
                    <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</option>
                    <option value="POSITIVE">üòä ‡∏ö‡∏ß‡∏Å</option>
                    <option value="NEGATIVE">üò† ‡∏•‡∏ö</option>
                    <option value="NEUTRAL">üòê ‡∏Å‡∏•‡∏≤‡∏á</option>
                  </select>
                  <button
                    class="btn btn-sm btn-primary submit-feedback-btn"
                    data-model="b"
                  >
                    ‡∏™‡πà‡∏á Feedback
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Toast container -->
    <div
      id="toast-container"
      style="position: fixed; bottom: 20px; right: 20px; z-index: 1000"
    ></div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const analyzeBtn = document.getElementById("analyze-btn");
        const sampleBtn = document.getElementById("sample-btn");
        const inputText = document.getElementById("input-text");
        const resultsContainer = document.getElementById("results-container");
        const abToggle = document.getElementById("ab-toggle");
        const modelBSelect = document.getElementById("model-b-select");
        const modelBTypeDisplay = document.getElementById(
          "model-b-type-display",
        );

        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ä‡∏∑‡πà‡∏≠ Model B ‡πÉ‡∏ô UI
        modelBSelect.addEventListener("change", () => {
          const selected =
            modelBSelect.options[modelBSelect.selectedIndex].text;
          modelBTypeDisplay.textContent = selected.split(": ")[1] || "Unknown";
        });

        // ‡∏ã‡πà‡∏≠‡∏ô/‡πÅ‡∏™‡∏î‡∏á dropdown ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î A/B
        abToggle.addEventListener("change", () => {
          modelBSelect.style.display = abToggle.checked ? "block" : "none";
        });

        function pick(arr) {
          return arr[Math.floor(Math.random() * arr.length)];
        }

        function generateSampleText() {
          const products = [
            "‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤",
            "‡∏Ç‡∏≠‡∏á",
            "‡∏™‡∏¥‡πà‡∏á‡∏ô‡∏µ‡πâ",
            "‡πÑ‡∏≠‡πÄ‡∏ó‡∏°",
            "‡∏Ç‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏±‡πà‡∏á",
            "‡∏û‡∏±‡∏™‡∏î‡∏∏",
            "‡∏Ç‡∏≠‡∏á‡∏ä‡∏¥‡πâ‡∏ô‡∏ô‡∏µ‡πâ",
            "‡πÄ‡∏™‡∏∑‡πâ‡∏≠",
            "‡∏£‡∏≠‡∏á‡πÄ‡∏ó‡πâ‡∏≤",
            "‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå",
            "‡πÄ‡∏Ñ‡∏™‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå",
            "‡∏´‡∏π‡∏ü‡∏±‡∏á",
            "‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤",
            "‡∏ô‡∏≤‡∏¨‡∏¥‡∏Å‡∏≤",
            "‡∏Ñ‡∏£‡∏µ‡∏°",
            "‡∏°‡∏≤‡∏™‡∏Å‡πå‡∏´‡∏ô‡πâ‡∏≤",
            "‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÄ‡∏™‡∏£‡∏¥‡∏°",
            "‡∏Ç‡∏≠‡∏á‡πÄ‡∏•‡πà‡∏ô",
            "‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÅ‡∏ï‡πà‡∏á‡∏´‡∏ô‡πâ‡∏≤",
          ];

          const positives = [
            "‡∏î‡∏µ‡∏°‡∏≤‡∏Å",
            "‡∏õ‡∏£‡∏∞‡∏ó‡∏±‡∏ö‡πÉ‡∏à",
            "‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡πà‡∏≤",
            "‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏î‡∏µ",
            "‡∏™‡∏ß‡∏¢",
            "‡πÉ‡∏™‡πà‡∏™‡∏ö‡∏≤‡∏¢",
            "‡πÄ‡∏£‡πá‡∏ß",
            "‡∏ó‡∏ô‡∏ó‡∏≤‡∏ô",
            "‡πÅ‡∏û‡πá‡∏Å‡∏î‡∏µ",
            "‡∏™‡πà‡∏á‡πÑ‡∏ß",
            "‡∏Ç‡∏≠‡∏á‡πÅ‡∏ó‡πâ",
            "‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡πÄ‡∏Å‡∏¥‡∏ô‡∏£‡∏≤‡∏Ñ‡∏≤",
            "‡∏ä‡∏≠‡∏ö‡∏°‡∏≤‡∏Å",
            "‡πÑ‡∏°‡πà‡∏ú‡∏¥‡∏î‡∏´‡∏ß‡∏±‡∏á",
          ];

          const negatives = [
            "‡πÅ‡∏¢‡πà",
            "‡πÑ‡∏°‡πà‡∏î‡∏µ",
            "‡∏ú‡∏¥‡∏î‡∏´‡∏ß‡∏±‡∏á",
            "‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏ï‡πà‡∏≥",
            "‡∏Ç‡∏≠‡∏á‡∏õ‡∏•‡∏≠‡∏°",
            "‡∏™‡πà‡∏á‡∏ä‡πâ‡∏≤",
            "‡πÅ‡∏û‡πá‡∏Å‡πÅ‡∏¢‡πà",
            "‡πÉ‡∏ä‡πâ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ",
            "‡∏´‡∏•‡∏∏‡∏î‡∏•‡∏≠‡∏Å",
            "‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏õ‡∏Å",
            "‡∏Å‡∏•‡∏¥‡πà‡∏ô‡πÅ‡∏£‡∏á",
            "‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å",
            "‡∏ä‡∏≥‡∏£‡∏∏‡∏î",
            "‡πÑ‡∏°‡πà‡∏Ñ‡∏∏‡πâ‡∏°‡∏£‡∏≤‡∏Ñ‡∏≤",
            "‡∏ã‡∏∑‡πâ‡∏≠‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏™‡∏µ‡∏¢‡∏î‡∏≤‡∏¢",
          ];

          const neutrals = [
            "‡πÇ‡∏≠‡πÄ‡∏Ñ‡∏ô‡∏∞",
            "‡∏û‡∏≠‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ",
            "‡∏Å‡∏•‡∏≤‡∏á‡πÜ",
            "‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÅ‡∏¢‡πà",
            "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏õ‡∏£‡∏∞‡∏ó‡∏±‡∏ö‡πÉ‡∏à",
            "‡πÄ‡∏â‡∏¢‡πÜ",
          ];
          const reasons = [
            "‡πÅ‡∏ï‡πà‡∏™‡πà‡∏á‡∏ä‡πâ‡∏≤‡πÑ‡∏õ‡∏´‡∏ô‡πà‡∏≠‡∏¢",
            "‡πÅ‡∏ï‡πà‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡πÑ‡∏°‡πà‡∏Ñ‡πà‡∏≠‡∏¢‡∏î‡∏µ",
            "‡πÅ‡∏ï‡πà‡∏£‡∏≤‡∏Ñ‡∏≤‡πÅ‡∏û‡∏á‡πÄ‡∏Å‡∏¥‡∏ô",
            "‡πÅ‡∏ï‡πà‡∏™‡∏µ‡πÄ‡∏û‡∏µ‡πâ‡∏¢‡∏ô",
            "‡πÅ‡∏ï‡πà‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏•‡πá‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏Ñ‡∏¥‡∏î",
            "‡πÅ‡∏ï‡πà‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡πÑ‡∏°‡πà‡∏ô‡∏≤‡∏ô",
            "‡πÅ‡∏ï‡πà‡πÅ‡∏û‡πá‡∏Å‡πÑ‡∏°‡πà‡∏î‡∏µ",
            "‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏Ñ‡πà‡∏≠‡∏¢‡∏ï‡∏£‡∏á‡∏ï‡∏≤‡∏°‡∏£‡∏µ‡∏ß‡∏¥‡∏ß",
          ];
          const emojis = ["üòä", "üòç", "üëç", "üëé", "üò§", "üòê", "ü§î", "üòÖ", "ü´†"];

          const patterns = [
            () => `${pick(products)} ${pick(positives)} ‡∏°‡∏≤‡∏Å‡∏Å‡∏Å! ${pick(emojis)}`,
            () => `‡∏™‡∏±‡πà‡∏á‡∏°‡∏≤‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏°‡πà‡∏ú‡∏¥‡∏î‡∏´‡∏ß‡∏±‡∏á‡πÄ‡∏•‡∏¢ ${pick(positives)} ‡∏à‡∏£‡∏¥‡∏á‡πÜ üòç`,
            () => `‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡πà‡∏≤‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏∏‡∏î‡πÜ ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö ${pick(products)} ‡∏ä‡∏¥‡πâ‡∏ô‡∏ô‡∏µ‡πâ üëç`,
            () => `‡∏™‡πà‡∏á‡πÑ‡∏ß ‡πÅ‡∏û‡πá‡∏Å‡πÅ‡∏ô‡πà‡∏ô ‡∏Ç‡∏≠‡∏á‡∏î‡∏µ‡πÄ‡∏Å‡∏¥‡∏ô‡∏Ñ‡∏≤‡∏î! ${pick(emojis)}`,
            () => `${pick(products)} ‡πÅ‡∏¢‡πà‡∏°‡∏≤‡∏Å ‡πÑ‡∏°‡πà‡∏Ñ‡∏∏‡πâ‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏•‡∏¢ üò§`,
            () => `‡∏ú‡∏¥‡∏î‡∏´‡∏ß‡∏±‡∏á‡∏™‡∏∏‡∏î‡πÜ ‡∏Ç‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏õ‡∏Å ‡πÅ‡∏ñ‡∏°‡∏™‡πà‡∏á‡∏ä‡πâ‡∏≤‡∏≠‡∏µ‡∏Å ü´†`,
            () => `‡∏≠‡∏¢‡πà‡∏≤‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏•‡∏¢! ${pick(negatives)} ‡∏°‡∏≤‡∏Å ‡∏ã‡∏∑‡πâ‡∏≠‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏™‡∏µ‡∏¢‡∏î‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô üí∏`,
            () => `‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏Ñ‡∏¥‡∏î‡πÑ‡∏ß‡πâ‡πÄ‡∏¢‡∏≠‡∏∞‡∏°‡∏≤‡∏Å üëé`,
            () => `${pick(products)} ‡πÇ‡∏≠‡πÄ‡∏Ñ‡∏ô‡∏∞ ‡πÅ‡∏ï‡πà${pick(reasons)} ü§î`,
            () => `‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏î‡∏µ‡πÄ‡∏•‡∏¥‡∏® ‡∏ñ‡∏∑‡∏≠‡∏ß‡πà‡∏≤${pick(neutrals)} ‡∏Ñ‡πà‡∏∞`,
            () => `‡∏î‡∏µ‡πÉ‡∏ô‡∏ö‡∏≤‡∏á‡∏à‡∏∏‡∏î ‡πÅ‡∏ï‡πà${pick(reasons)} üòÖ`,
            () => `‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÅ‡∏¢‡πà ‡πÅ‡∏ï‡πà‡∏Å‡πá‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏î‡∏µ‡∏°‡∏≤‡∏Å ‡πÉ‡∏´‡πâ 3 ‡∏î‡∏≤‡∏ß‡∏•‡∏∞‡∏Å‡∏±‡∏ô`,
          ];

          return pick(patterns)();
        }

        sampleBtn.addEventListener("click", () => {
          inputText.value = generateSampleText();
        });

        analyzeBtn.addEventListener("click", async () => {
          const text = inputText.value.trim();
          if (!text) {
            alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°!");
            return;
          }

          try {
            let url, body;
            if (!abToggle.checked) {
              // ‡πÇ‡∏´‡∏°‡∏î‡πÄ‡∏î‡∏µ‡∏¢‡∏ß: ‡πÉ‡∏ä‡πâ Model A ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
              url = "/predict";
              body = JSON.stringify({ text });
            } else {
              // ‡πÇ‡∏´‡∏°‡∏î‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö: ‡∏™‡πà‡∏á model_b_type
              const modelBType = modelBSelect.value;
              url = "/predict-ab";
              body = JSON.stringify({ text, model_b_type: modelBType });
            }

            const response = await fetch(url, {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: body,
            });

            if (!response.ok) {
              const errorText = await response.text();
              throw new Error(errorText || "Request failed");
            }

            const data = await response.json();

            if (!abToggle.checked) {
              updateResultsSingle(data);
            } else {
              updateResultsAB(data);
            }

            resultsContainer.style.display = "block";

            // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå feedback state
            document
              .querySelectorAll(".feedback-btn")
              .forEach((btn) => btn.classList.remove("selected"));
            document
              .querySelectorAll(".true-label-section")
              .forEach((sec) => (sec.style.display = "none"));
          } catch (error) {
            console.error(error);
            alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + error.message);
          }
        });

        // ========== Feedback & Rendering (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°) ==========
        function attachFeedbackListeners() {
          document.querySelectorAll(".feedback-btn").forEach((btn) => {
            btn.addEventListener("click", (e) => {
              const model = e.target.dataset.model;
              const feedback = e.target.dataset.feedback;
              const text = inputText.value.trim();
              if (!text) return;

              document
                .querySelectorAll(`.feedback-btn[data-model="${model}"]`)
                .forEach((b) => b.classList.remove("selected"));
              e.target.classList.add("selected");

              const section = document.querySelector(
                `.true-label-section[data-model="${model}"]`,
              );
              if (feedback === "incorrect") {
                section.style.display = "block";
                section.querySelector("select").value = "";
              } else {
                section.style.display = "none";
                sendFeedback({
                  text,
                  model: model === "a" ? "model_a" : "model_b",
                  feedback: "correct",
                  predicted_label:
                    model === "a"
                      ? document.getElementById("model-a-label").textContent
                      : document.getElementById("model-b-label").textContent,
                  confidence: parseFloat(
                    model === "a"
                      ? document.getElementById("model-a-confidence")
                          .textContent
                      : document.getElementById("model-b-confidence")
                          .textContent,
                  ),
                  model_name:
                    model === "a"
                      ? document.getElementById("model-a-name").textContent
                      : document.getElementById("model-b-name").textContent,
                });
              }
            });
          });

          document.querySelectorAll(".submit-feedback-btn").forEach((btn) => {
            btn.addEventListener("click", async (e) => {
              const model = e.target.dataset.model;
              const section = document.querySelector(
                `.true-label-section[data-model="${model}"]`,
              );
              const select = section.querySelector("select");
              const trueLabel = select.value;
              if (!trueLabel) {
                showToast("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á", "error");
                return;
              }

              const text = inputText.value.trim();
              if (!text) return;

              const payload = {
                text,
                model: model === "a" ? "model_a" : "model_b",
                feedback: "incorrect",
                true_label: trueLabel,
                predicted_label:
                  model === "a"
                    ? document.getElementById("model-a-label").textContent
                    : document.getElementById("model-b-label").textContent,
                confidence: parseFloat(
                  model === "a"
                    ? document.getElementById("model-a-confidence").textContent
                    : document.getElementById("model-b-confidence").textContent,
                ),
                model_name:
                  model === "a"
                    ? document.getElementById("model-a-name").textContent
                    : document.getElementById("model-b-name").textContent,
                timestamp: new Date().toISOString(),
              };

              await sendFeedback(payload);
              section.style.display = "none";
            });
          });
        }

        attachFeedbackListeners();

        async function sendFeedback(payload) {
          try {
            const res = await fetch("/feedback", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(payload),
            });
            if (res.ok) {
              showToast(
                payload.feedback === "correct"
                  ? "‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö feedback!"
                  : "‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ä‡πà‡∏ß‡∏¢‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏£‡∏∞‡∏ö‡∏ö!",
              );
            } else {
              showToast("‡∏™‡πà‡∏á feedback ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à", "error");
            }
          } catch (err) {
            console.error("Feedback error:", err);
            showToast("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏Ç‡∏ì‡∏∞‡∏™‡πà‡∏á feedback", "error");
          }
        }

        function showToast(message, type = "success") {
          const toast = document.createElement("div");
          toast.className = `alert alert-${type === "error" ? "danger" : "success"} alert-dismissible fade show`;
          toast.style.minWidth = "250px";
          toast.innerHTML = `${message}<button type="button" class="btn-close" data-bs-dismiss="alert"></button>`;
          document.getElementById("toast-container").appendChild(toast);
          setTimeout(() => {
            if (toast.parentNode) toast.parentNode.removeChild(toast);
          }, 3000);
        }

        function getColor(label) {
          if (label === "POSITIVE") return "#28a745";
          if (label === "NEGATIVE") return "#dc3545";
          return "#ffc107";
        }

        function updateResultsAB(data) {
          // Model A
          const a = data.model_a;
          document.getElementById("model-a-label").textContent = a.label;
          document.getElementById("model-a-label").className =
            `label-${a.label.toLowerCase()} mb-2`;
          document.getElementById("model-a-confidence").textContent =
            a.confidence;
          document.getElementById("model-a-latency").textContent = a.latency_ms;
          document.getElementById("model-a-progress").style.width =
            `${a.confidence * 100}%`;
          document.getElementById("model-a-progress").style.backgroundColor =
            getColor(a.label);
          document.getElementById("model-a-name").textContent =
            `${a.model_name} ‚Ä¢ ${a.version}`;
          renderWords(
            "model-a-words",
            a.important_words || [],
            a.word_sentiments || [],
          );

          // Model B
          const b = data.model_b;
          if (b) {
            document.getElementById("model-b-label").textContent = b.label;
            document.getElementById("model-b-label").className =
              `label-${b.label.toLowerCase()} mb-2`;
            document.getElementById("model-b-confidence").textContent =
              b.confidence;
            document.getElementById("model-b-latency").textContent =
              b.latency_ms;
            document.getElementById("model-b-progress").style.width =
              `${b.confidence * 100}%`;
            document.getElementById("model-b-progress").style.backgroundColor =
              getColor(b.label);
            document.getElementById("model-b-name").textContent =
              `${b.model_name} ‚Ä¢ ${b.version}`;
            renderWords(
              "model-b-words",
              b.important_words || [],
              b.word_sentiments || [],
            );
            document.querySelector(".col-md-6:nth-child(2)").style.display =
              "block";
          } else {
            document.querySelector(".col-md-6:nth-child(2)").style.display =
              "none";
          }
        }

        function updateResultsSingle(data) {
          document.getElementById("model-a-label").textContent = data.label;
          document.getElementById("model-a-label").className =
            `label-${data.label.toLowerCase()} mb-2`;
          document.getElementById("model-a-confidence").textContent =
            data.confidence;
          document.getElementById("model-a-latency").textContent =
            data.latency_ms;
          document.getElementById("model-a-progress").style.width =
            `${data.confidence * 100}%`;
          document.getElementById("model-a-progress").style.backgroundColor =
            getColor(data.label);
          document.getElementById("model-a-name").textContent =
            `${data.model} ‚Ä¢ ${data.version}`;
          renderWords(
            "model-a-words",
            data.important_words || [],
            data.word_sentiments || [],
          );
          document.querySelector(".col-md-6:nth-child(2)").style.display =
            "none";
        }

        function renderWords(containerId, words, sentiments) {
          const container = document.getElementById(containerId);
          container.innerHTML = "";
          words.forEach((word, i) => {
            const span = document.createElement("span");
            span.textContent = word;
            span.className = `word-tag ${sentiments[i]}-word`;
            container.appendChild(span);
          });
        }
      });
    </script>
  </body>
</html>
