<!doctype html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Thai Sentiment Analysis ‚Äî ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡πÇ‡∏°‡πÄ‡∏î‡∏•</title>
    <meta name="description" content="‡∏£‡∏∞‡∏ö‡∏ö‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢ ‡∏î‡πâ‡∏ß‡∏¢ TF-IDF ‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö A/B Testing ‡∏´‡∏•‡∏≤‡∏¢‡πÇ‡∏°‡πÄ‡∏î‡∏•" />
    <link rel="stylesheet" href="/static/style.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
  </head>

  <body>
    <div class="app-container">
      <!-- ===== Header ===== -->
      <header class="app-header">
        <h1><i class="fas fa-brain"></i> Thai Sentiment Analysis</h1>
        <p>‡∏£‡∏∞‡∏ö‡∏ö‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢ ‚Äî ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö A/B Testing</p>
      </header>

      <!-- ===== Main Card ===== -->
      <div class="glass-card" style="position:relative;">
        <!-- Loading Overlay -->
        <div class="loading-overlay" id="loading-overlay">
          <div class="spinner"></div>
        </div>

        <!-- Controls Bar -->
        <div class="controls-bar">
          <div class="controls-left">
            <span class="tab-badge">
              <i class="fas fa-chart-line"></i> Sentiment
            </span>
          </div>
          <div class="controls-right">
            <div class="toggle-wrapper">
              <label class="toggle-switch">
                <input type="checkbox" id="ab-toggle" checked />
                <span class="slider"></span>
              </label>
              <label for="ab-toggle">‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö A/B</label>
            </div>
            <select id="model-b-select" class="model-select">
              <option value="linear">Linear SVM</option>
              <option value="rf">Random Forest</option>
              <option value="nb">Naive Bayes</option>
              <option value="lgbm">LightGBM</option>
              <option value="et">Extra Trees</option>
            </select>
          </div>
        </div>

        <!-- Text Input -->
        <div class="input-area">
          <label for="input-text"><i class="fas fa-pen-to-square"></i> ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°:</label>
          <textarea
            id="input-text"
            class="input-textarea"
            rows="4"
            placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å..."
          ></textarea>
        </div>

        <!-- Action Buttons -->
        <div class="btn-group">
          <button id="analyze-btn" class="btn-primary-glow">
            <i class="fas fa-magnifying-glass-chart"></i> ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå
          </button>
          <button id="sample-btn" class="btn-ghost">
            <i class="fas fa-shuffle"></i> ‡πÇ‡∏´‡∏•‡∏î‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á
          </button>
          <a href="/errors" class="btn-ghost">
            <i class="fas fa-triangle-exclamation"></i> ‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î
          </a>
        </div>

        <!-- ===== Results Section ===== -->
        <div id="results-container" class="results-section" style="display: none">
          <h4 class="results-title"><i class="fas fa-scale-balanced"></i> ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå</h4>
          <div class="results-grid" id="results-grid">
            <!-- Model A Card -->
            <div class="result-card card-a" id="card-a">
              <div class="result-card-header">
                <h3><i class="fas fa-robot"></i> ‡πÇ‡∏°‡πÄ‡∏î‡∏• A</h3>
                <span class="model-badge">Logistic Regression</span>
              </div>

              <div id="model-a-label" class="sentiment-badge neutral">
                <i class="fas fa-minus-circle"></i> <span>NEUTRAL</span>
              </div>

              <div class="metrics-row">
                <div class="metric">
                  <span class="metric-label">Confidence</span>
                  <span class="metric-value confidence-val" id="model-a-confidence">0.00</span>
                </div>
                <div class="metric">
                  <span class="metric-label">Latency</span>
                  <span class="metric-value latency-val"><span id="model-a-latency">0</span> ms</span>
                </div>
              </div>

              <div class="progress-track">
                <div id="model-a-progress" class="progress-fill neutral" style="width: 0%"></div>
              </div>

              <div class="model-info">
                <i class="fas fa-microchip"></i> <span id="model-a-name">-</span>
              </div>

              <div class="feedback-row">
                <span class="feedback-btn" data-model="a" data-feedback="correct">üëç</span>
                <span class="feedback-btn" data-model="a" data-feedback="incorrect">üëé</span>
                <span class="feedback-hint">‡∏Å‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ feedback</span>
              </div>

              <div class="true-label-section" data-model="a">
                <select class="true-label-select">
                  <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</option>
                  <option value="POSITIVE">üòä ‡∏ö‡∏ß‡∏Å (Positive)</option>
                  <option value="NEGATIVE">üò† ‡∏•‡∏ö (Negative)</option>
                  <option value="NEUTRAL">üòê ‡∏Å‡∏•‡∏≤‡∏á (Neutral)</option>
                </select>
                <button class="btn-submit-feedback" data-model="a">
                  <i class="fas fa-paper-plane"></i> ‡∏™‡πà‡∏á Feedback
                </button>
              </div>
            </div>

            <!-- Model B Card -->
            <div class="result-card card-b" id="card-b">
              <div class="result-card-header">
                <h3><i class="fas fa-robot"></i> ‡πÇ‡∏°‡πÄ‡∏î‡∏• B</h3>
                <span class="model-badge" id="model-b-badge">Linear SVM</span>
              </div>

              <div id="model-b-label" class="sentiment-badge neutral">
                <i class="fas fa-minus-circle"></i> <span>NEUTRAL</span>
              </div>

              <div class="metrics-row">
                <div class="metric">
                  <span class="metric-label">Confidence</span>
                  <span class="metric-value confidence-val" id="model-b-confidence">0.00</span>
                </div>
                <div class="metric">
                  <span class="metric-label">Latency</span>
                  <span class="metric-value latency-val"><span id="model-b-latency">0</span> ms</span>
                </div>
              </div>

              <div class="progress-track">
                <div id="model-b-progress" class="progress-fill neutral" style="width: 0%"></div>
              </div>

              <div class="model-info">
                <i class="fas fa-microchip"></i> <span id="model-b-name">-</span>
              </div>

              <div class="feedback-row">
                <span class="feedback-btn" data-model="b" data-feedback="correct">üëç</span>
                <span class="feedback-btn" data-model="b" data-feedback="incorrect">üëé</span>
                <span class="feedback-hint">‡∏Å‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ feedback</span>
              </div>

              <div class="true-label-section" data-model="b">
                <select class="true-label-select">
                  <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</option>
                  <option value="POSITIVE">üòä ‡∏ö‡∏ß‡∏Å (Positive)</option>
                  <option value="NEGATIVE">üò† ‡∏•‡∏ö (Negative)</option>
                  <option value="NEUTRAL">üòê ‡∏Å‡∏•‡∏≤‡∏á (Neutral)</option>
                </select>
                <button class="btn-submit-feedback" data-model="b">
                  <i class="fas fa-paper-plane"></i> ‡∏™‡πà‡∏á Feedback
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Footer -->
      <div style="text-align:center; margin-top:24px; color:var(--text-muted); font-size:0.78rem;">
        <p>Thai Sentiment Analysis System ‚Äî TF-IDF + ML Models &middot; Built with FastAPI</p>
      </div>
    </div>

    <!-- Toast Container -->
    <div id="toast-container"></div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const analyzeBtn = document.getElementById("analyze-btn");
        const sampleBtn = document.getElementById("sample-btn");
        const inputText = document.getElementById("input-text");
        const resultsContainer = document.getElementById("results-container");
        const resultsGrid = document.getElementById("results-grid");
        const abToggle = document.getElementById("ab-toggle");
        const modelBSelect = document.getElementById("model-b-select");
        const modelBBadge = document.getElementById("model-b-badge");
        const cardB = document.getElementById("card-b");
        const loadingOverlay = document.getElementById("loading-overlay");

        // Model B display name
        const modelBNames = {
          linear: "Linear SVM",
          rf: "Random Forest",
          nb: "Naive Bayes",
          lgbm: "LightGBM",
          et: "Extra Trees",
        };

        modelBSelect.addEventListener("change", () => {
          const val = modelBSelect.value;
          modelBBadge.textContent = modelBNames[val] || val;
        });

        // Toggle A/B
        function updateABVisibility() {
          const isAB = abToggle.checked;
          modelBSelect.style.display = isAB ? "block" : "none";
          if (resultsContainer.style.display !== "none") {
            cardB.style.display = isAB ? "block" : "none";
            resultsGrid.classList.toggle("single-mode", !isAB);
          }
        }
        abToggle.addEventListener("change", updateABVisibility);
        updateABVisibility();

        // ========== Sample Text Generator ==========
        function pick(arr) {
          return arr[Math.floor(Math.random() * arr.length)];
        }

        function generateSampleText() {
          const products = [
            "‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤","‡∏Ç‡∏≠‡∏á","‡∏™‡∏¥‡πà‡∏á‡∏ô‡∏µ‡πâ","‡πÑ‡∏≠‡πÄ‡∏ó‡∏°","‡∏Ç‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏±‡πà‡∏á","‡∏û‡∏±‡∏™‡∏î‡∏∏","‡∏Ç‡∏≠‡∏á‡∏ä‡∏¥‡πâ‡∏ô‡∏ô‡∏µ‡πâ",
            "‡πÄ‡∏™‡∏∑‡πâ‡∏≠","‡∏£‡∏≠‡∏á‡πÄ‡∏ó‡πâ‡∏≤","‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå","‡πÄ‡∏Ñ‡∏™‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå","‡∏´‡∏π‡∏ü‡∏±‡∏á","‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤","‡∏ô‡∏≤‡∏¨‡∏¥‡∏Å‡∏≤",
            "‡∏Ñ‡∏£‡∏µ‡∏°","‡∏°‡∏≤‡∏™‡∏Å‡πå‡∏´‡∏ô‡πâ‡∏≤","‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÄ‡∏™‡∏£‡∏¥‡∏°","‡∏Ç‡∏≠‡∏á‡πÄ‡∏•‡πà‡∏ô","‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÅ‡∏ï‡πà‡∏á‡∏´‡∏ô‡πâ‡∏≤",
          ];
          const positives = [
            "‡∏î‡∏µ‡∏°‡∏≤‡∏Å","‡∏õ‡∏£‡∏∞‡∏ó‡∏±‡∏ö‡πÉ‡∏à","‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡πà‡∏≤","‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏î‡∏µ","‡∏™‡∏ß‡∏¢","‡πÉ‡∏™‡πà‡∏™‡∏ö‡∏≤‡∏¢","‡πÄ‡∏£‡πá‡∏ß",
            "‡∏ó‡∏ô‡∏ó‡∏≤‡∏ô","‡πÅ‡∏û‡πá‡∏Å‡∏î‡∏µ","‡∏™‡πà‡∏á‡πÑ‡∏ß","‡∏Ç‡∏≠‡∏á‡πÅ‡∏ó‡πâ","‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡πÄ‡∏Å‡∏¥‡∏ô‡∏£‡∏≤‡∏Ñ‡∏≤","‡∏ä‡∏≠‡∏ö‡∏°‡∏≤‡∏Å","‡πÑ‡∏°‡πà‡∏ú‡∏¥‡∏î‡∏´‡∏ß‡∏±‡∏á",
          ];
          const negatives = [
            "‡πÅ‡∏¢‡πà","‡πÑ‡∏°‡πà‡∏î‡∏µ","‡∏ú‡∏¥‡∏î‡∏´‡∏ß‡∏±‡∏á","‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏ï‡πà‡∏≥","‡∏Ç‡∏≠‡∏á‡∏õ‡∏•‡∏≠‡∏°","‡∏™‡πà‡∏á‡∏ä‡πâ‡∏≤","‡πÅ‡∏û‡πá‡∏Å‡πÅ‡∏¢‡πà",
            "‡πÉ‡∏ä‡πâ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ","‡∏´‡∏•‡∏∏‡∏î‡∏•‡∏≠‡∏Å","‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏õ‡∏Å","‡∏Å‡∏•‡∏¥‡πà‡∏ô‡πÅ‡∏£‡∏á","‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å","‡∏ä‡∏≥‡∏£‡∏∏‡∏î",
            "‡πÑ‡∏°‡πà‡∏Ñ‡∏∏‡πâ‡∏°‡∏£‡∏≤‡∏Ñ‡∏≤","‡∏ã‡∏∑‡πâ‡∏≠‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏™‡∏µ‡∏¢‡∏î‡∏≤‡∏¢",
          ];
          const neutrals = ["‡πÇ‡∏≠‡πÄ‡∏Ñ‡∏ô‡∏∞","‡∏û‡∏≠‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ","‡∏Å‡∏•‡∏≤‡∏á‡πÜ","‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÅ‡∏¢‡πà","‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏õ‡∏£‡∏∞‡∏ó‡∏±‡∏ö‡πÉ‡∏à","‡πÄ‡∏â‡∏¢‡πÜ"];
          const reasons = [
            "‡πÅ‡∏ï‡πà‡∏™‡πà‡∏á‡∏ä‡πâ‡∏≤‡πÑ‡∏õ‡∏´‡∏ô‡πà‡∏≠‡∏¢","‡πÅ‡∏ï‡πà‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡πÑ‡∏°‡πà‡∏Ñ‡πà‡∏≠‡∏¢‡∏î‡∏µ","‡πÅ‡∏ï‡πà‡∏£‡∏≤‡∏Ñ‡∏≤‡πÅ‡∏û‡∏á‡πÄ‡∏Å‡∏¥‡∏ô","‡πÅ‡∏ï‡πà‡∏™‡∏µ‡πÄ‡∏û‡∏µ‡πâ‡∏¢‡∏ô",
            "‡πÅ‡∏ï‡πà‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏•‡πá‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏Ñ‡∏¥‡∏î","‡πÅ‡∏ï‡πà‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡πÑ‡∏°‡πà‡∏ô‡∏≤‡∏ô","‡πÅ‡∏ï‡πà‡πÅ‡∏û‡πá‡∏Å‡πÑ‡∏°‡πà‡∏î‡∏µ","‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏Ñ‡πà‡∏≠‡∏¢‡∏ï‡∏£‡∏á‡∏ï‡∏≤‡∏°‡∏£‡∏µ‡∏ß‡∏¥‡∏ß",
          ];
          const emojis = ["üòä","üòç","üëç","üëé","üò§","üòê","ü§î","üòÖ","ü´†"];
          const patterns = [
            () => `${pick(products)} ${pick(positives)} ‡∏°‡∏≤‡∏Å‡∏Å‡∏Å! ${pick(emojis)}`,
            () => `‡∏™‡∏±‡πà‡∏á‡∏°‡∏≤‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏°‡πà‡∏ú‡∏¥‡∏î‡∏´‡∏ß‡∏±‡∏á‡πÄ‡∏•‡∏¢ ${pick(positives)} ‡∏à‡∏£‡∏¥‡∏á‡πÜ üòç`,
            () => `‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡πà‡∏≤‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏∏‡∏î‡πÜ ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö ${pick(products)} ‡∏ä‡∏¥‡πâ‡∏ô‡∏ô‡∏µ‡πâ üëç`,
            () => `‡∏™‡πà‡∏á‡πÑ‡∏ß ‡πÅ‡∏û‡πá‡∏Å‡πÅ‡∏ô‡πà‡∏ô ‡∏Ç‡∏≠‡∏á‡∏î‡∏µ‡πÄ‡∏Å‡∏¥‡∏ô‡∏Ñ‡∏≤‡∏î! ${pick(emojis)}`,
            () => `${pick(products)} ‡πÅ‡∏¢‡πà‡∏°‡∏≤‡∏Å ‡πÑ‡∏°‡πà‡∏Ñ‡∏∏‡πâ‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏•‡∏¢ üò§`,
            () => `‡∏ú‡∏¥‡∏î‡∏´‡∏ß‡∏±‡∏á‡∏™‡∏∏‡∏î‡πÜ ‡∏Ç‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏õ‡∏Å ‡πÅ‡∏ñ‡∏°‡∏™‡πà‡∏á‡∏ä‡πâ‡∏≤‡∏≠‡∏µ‡∏Å ü´†`,
            () => `‡∏≠‡∏¢‡πà‡∏≤‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏•‡∏¢! ${pick(negatives)} ‡∏°‡∏≤‡∏Å ‡∏ã‡∏∑‡πâ‡∏≠‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏™‡∏µ‡∏¢‡∏î‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô üí∏`,
            () => `‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏Ñ‡∏¥‡∏î‡πÑ‡∏ß‡πâ‡πÄ‡∏¢‡∏≠‡∏∞‡∏°‡∏≤‡∏Å üëé`,
            () => `${pick(products)} ‡πÇ‡∏≠‡πÄ‡∏Ñ‡∏ô‡∏∞ ‡πÅ‡∏ï‡πà${pick(reasons)} ü§î`,
            () => `‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏î‡∏µ‡πÄ‡∏•‡∏¥‡∏® ‡∏ñ‡∏∑‡∏≠‡∏ß‡πà‡∏≤${pick(neutrals)} ‡∏Ñ‡πà‡∏∞`,
            () => `‡∏î‡∏µ‡πÉ‡∏ô‡∏ö‡∏≤‡∏á‡∏à‡∏∏‡∏î ‡πÅ‡∏ï‡πà${pick(reasons)} üòÖ`,
            () => `‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÅ‡∏¢‡πà ‡πÅ‡∏ï‡πà‡∏Å‡πá‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏î‡∏µ‡∏°‡∏≤‡∏Å ‡πÉ‡∏´‡πâ 3 ‡∏î‡∏≤‡∏ß‡∏•‡∏∞‡∏Å‡∏±‡∏ô`,
          ];
          return pick(patterns)();
        }

        sampleBtn.addEventListener("click", () => {
          inputText.value = generateSampleText();
          inputText.focus();
        });

        // ========== Analyze ==========
        analyzeBtn.addEventListener("click", async () => {
          const text = inputText.value.trim();
          if (!text) {
            showToast("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°!", "error");
            return;
          }

          // Show loading
          loadingOverlay.classList.add("active");
          resultsContainer.style.display = "none";

          try {
            let url, body;
            if (!abToggle.checked) {
              url = "/predict";
              body = JSON.stringify({ text });
            } else {
              const modelBType = modelBSelect.value;
              url = "/predict-ab";
              body = JSON.stringify({ text, model_b_type: modelBType });
            }

            const response = await fetch(url, {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: body,
            });

            if (!response.ok) {
              const errorText = await response.text();
              throw new Error(errorText || "Request failed");
            }

            const data = await response.json();

            if (!abToggle.checked) {
              updateResultsSingle(data);
              cardB.style.display = "none";
              resultsGrid.classList.add("single-mode");
            } else {
              updateResultsAB(data);
              cardB.style.display = "block";
              resultsGrid.classList.remove("single-mode");
            }

            resultsContainer.style.display = "block";

            // Clear feedback state
            document.querySelectorAll(".feedback-btn").forEach((btn) => btn.classList.remove("selected"));
            document.querySelectorAll(".true-label-section").forEach((sec) => (sec.style.display = "none"));

          } catch (error) {
            console.error(error);
            showToast("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + error.message, "error");
          } finally {
            loadingOverlay.classList.remove("active");
          }
        });

        // ========== Rendering ==========
        function getSentimentIcon(label) {
          if (label === "POSITIVE") return "fa-face-smile";
          if (label === "NEGATIVE") return "fa-face-angry";
          return "fa-minus-circle";
        }

        function getSentimentClass(label) {
          if (label === "POSITIVE") return "positive";
          if (label === "NEGATIVE") return "negative";
          return "neutral";
        }

        function updateSentimentBadge(elementId, label) {
          const el = document.getElementById(elementId);
          const cls = getSentimentClass(label);
          el.className = `sentiment-badge ${cls}`;
          el.innerHTML = `<i class="fas ${getSentimentIcon(label)}"></i> <span>${label}</span>`;
        }

        function updateProgressBar(elementId, confidence, label) {
          const bar = document.getElementById(elementId);
          const cls = getSentimentClass(label);
          bar.className = `progress-fill ${cls}`;
          bar.style.width = `${Math.min(confidence * 100, 100)}%`;
        }

        function updateResultsAB(data) {
          const a = data.model_a;
          updateSentimentBadge("model-a-label", a.label);
          document.getElementById("model-a-confidence").textContent = a.confidence;
          document.getElementById("model-a-latency").textContent = a.latency_ms;
          updateProgressBar("model-a-progress", a.confidence, a.label);
          document.getElementById("model-a-name").textContent = `${a.model_name} ‚Ä¢ ${a.version}`;

          const b = data.model_b;
          if (b) {
            updateSentimentBadge("model-b-label", b.label);
            document.getElementById("model-b-confidence").textContent = b.confidence;
            document.getElementById("model-b-latency").textContent = b.latency_ms;
            updateProgressBar("model-b-progress", b.confidence, b.label);
            document.getElementById("model-b-name").textContent = `${b.model_name} ‚Ä¢ ${b.version}`;
          }
        }

        function updateResultsSingle(data) {
          updateSentimentBadge("model-a-label", data.label);
          document.getElementById("model-a-confidence").textContent = data.confidence;
          document.getElementById("model-a-latency").textContent = data.latency_ms;
          updateProgressBar("model-a-progress", data.confidence, data.label);
          document.getElementById("model-a-name").textContent = `${data.model} ‚Ä¢ ${data.version}`;
        }

        // ========== Feedback ==========
        function attachFeedbackListeners() {
          document.querySelectorAll(".feedback-btn").forEach((btn) => {
            btn.addEventListener("click", (e) => {
              const model = e.target.dataset.model || e.target.closest('.feedback-btn').dataset.model;
              const feedback = e.target.dataset.feedback || e.target.closest('.feedback-btn').dataset.feedback;
              const text = inputText.value.trim();
              if (!text) return;

              document.querySelectorAll(`.feedback-btn[data-model="${model}"]`)
                .forEach((b) => b.classList.remove("selected"));
              e.target.closest('.feedback-btn') ?
                e.target.closest('.feedback-btn').classList.add("selected") :
                e.target.classList.add("selected");

              const section = document.querySelector(`.true-label-section[data-model="${model}"]`);
              if (feedback === "incorrect") {
                section.style.display = "block";
                section.querySelector("select").value = "";
              } else {
                section.style.display = "none";
                const labelEl = document.getElementById(`model-${model}-label`);
                const confEl = document.getElementById(`model-${model}-confidence`);
                const nameEl = document.getElementById(`model-${model}-name`);
                sendFeedback({
                  text,
                  model: model === "a" ? "model_a" : "model_b",
                  feedback: "correct",
                  predicted_label: labelEl.querySelector("span").textContent,
                  confidence: parseFloat(confEl.textContent),
                  model_name: nameEl.textContent,
                });
              }
            });
          });

          document.querySelectorAll(".btn-submit-feedback").forEach((btn) => {
            btn.addEventListener("click", async (e) => {
              const model = e.target.dataset.model || e.target.closest('.btn-submit-feedback').dataset.model;
              const section = document.querySelector(`.true-label-section[data-model="${model}"]`);
              const select = section.querySelector("select");
              const trueLabel = select.value;
              if (!trueLabel) {
                showToast("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á", "error");
                return;
              }

              const text = inputText.value.trim();
              if (!text) return;

              const labelEl = document.getElementById(`model-${model}-label`);
              const confEl = document.getElementById(`model-${model}-confidence`);
              const nameEl = document.getElementById(`model-${model}-name`);

              await sendFeedback({
                text,
                model: model === "a" ? "model_a" : "model_b",
                feedback: "incorrect",
                true_label: trueLabel,
                predicted_label: labelEl.querySelector("span").textContent,
                confidence: parseFloat(confEl.textContent),
                model_name: nameEl.textContent,
                timestamp: new Date().toISOString(),
              });
              section.style.display = "none";
            });
          });
        }

        attachFeedbackListeners();

        async function sendFeedback(payload) {
          try {
            const res = await fetch("/feedback", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(payload),
            });
            if (res.ok) {
              showToast(
                payload.feedback === "correct"
                  ? "‚úÖ ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö feedback!"
                  : "üìù ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ä‡πà‡∏ß‡∏¢‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏£‡∏∞‡∏ö‡∏ö!",
                "success"
              );
            } else {
              showToast("‡∏™‡πà‡∏á feedback ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à", "error");
            }
          } catch (err) {
            console.error("Feedback error:", err);
            showToast("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏Ç‡∏ì‡∏∞‡∏™‡πà‡∏á feedback", "error");
          }
        }

        // ========== Toast ==========
        function showToast(message, type = "success") {
          const toast = document.createElement("div");
          toast.className = `toast-msg ${type}`;
          toast.innerHTML = `
            <span>${message}</span>
            <button class="toast-close" onclick="this.parentElement.remove()">‚úï</button>
          `;
          document.getElementById("toast-container").appendChild(toast);
          setTimeout(() => {
            if (toast.parentNode) {
              toast.style.opacity = "0";
              toast.style.transform = "translateY(10px)";
              setTimeout(() => toast.remove(), 300);
            }
          }, 3500);
        }

        // Allow Enter key (Ctrl+Enter) to analyze
        inputText.addEventListener("keydown", (e) => {
          if (e.ctrlKey && e.key === "Enter") {
            analyzeBtn.click();
          }
        });
      });
    </script>
  </body>
</html>
